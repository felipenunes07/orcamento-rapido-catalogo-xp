<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Catálogo XP Orçamento</title>
    <meta
      name="description"
      content="Gere orçamentos rápidos e diretos com nosso catálogo interativo."
    />
    <meta name="author" content="XP Orçamento" />

    <meta property="og:title" content="Catálogo XP Orçamento" />
    <meta
      property="og:description"
      content="Gere orçamentos rápidos e diretos com nosso catálogo interativo."
    />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/new-icon.png" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:image" content="/new-icon.png" />

    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" type="image/png" href="/images/xp-logo.png" />
    <link rel="apple-touch-icon" href="/images/xp-logo.png" />
    <meta name="theme-color" content="#000000" />
    
    <!-- Chat Widget Styles -->
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');

      * { 
          box-sizing: border-box; 
      }

      #gg-help-button {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 56px;
          height: 56px;
          border-radius: 50%;
          background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
          border: 2px solid rgba(147, 51, 234, 0.3);
          display: flex;
          justify-content: center;
          align-items: center;
          z-index: 99999;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
          cursor: pointer;
          transition: all 0.3s ease;
          padding: 0;
          animation: pulse 2s infinite, bounce 3s infinite, glow 2.5s infinite;
      }

      @keyframes glow {
          0%, 100% {
              border-color: rgba(147, 51, 234, 0.3);
          }
          50% {
              border-color: rgba(147, 51, 234, 0.8);
          }
      }

      @keyframes pulse {
          0% {
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(147, 51, 234, 0.8);
          }
          25% {
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 5px rgba(147, 51, 234, 0.6);
          }
          50% {
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 12px rgba(147, 51, 234, 0.4);
          }
          75% {
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 18px rgba(147, 51, 234, 0.2);
          }
          100% {
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2), 0 0 0 25px rgba(147, 51, 234, 0);
          }
      }

      @keyframes bounce {
          0%, 20%, 50%, 80%, 100% {
              transform: translateY(0);
          }
          40% {
              transform: translateY(-5px);
          }
          60% {
              transform: translateY(-3px);
          }
      }

      @media (max-width: 768px) {
          #gg-help-button {
              width: 50px;
              height: 50px;
              bottom: 20px;
              right: 20px;
          }
      }

      @media (max-width: 480px) {
          #gg-help-button {
              width: 46px;
              height: 46px;
              bottom: 15px;
              right: 15px;
          }
      }

      #gg-help-button:hover {
          transform: translateY(-2px) scale(1.1);
          box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3), 0 0 20px rgba(147, 51, 234, 0.6);
          border-color: rgba(147, 51, 234, 1);
          animation: none;
      }

      #gg-help-button:active {
          transform: translateY(0);
      }

      #gg-help-button.blink {
          animation: blink 1s infinite;
      }

      @keyframes blink {
          0%, 100% { box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); }
          50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
      }

      #gg-help-chat {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 380px;
          height: 520px;
          background: #ffffff;
          border-radius: 18px;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
          display: none;
          flex-direction: column;
          overflow: hidden;
          z-index: 99999;
          animation: slideUp 0.3s ease-out;
          font-family: 'Poppins', sans-serif;
      }

      @media (max-width: 768px) {
          #gg-help-chat {
              width: calc(100vw - 20px);
              height: calc(100vh - 40px);
              right: 10px;
              left: 10px;
              bottom: 10px;
              top: 10px;
          }
      }

      @media (max-width: 480px) {
          #gg-help-chat {
              width: 100vw;
              height: calc(100vh - env(safe-area-inset-bottom));
              max-height: calc(100vh - 60px);
              right: 0;
              left: 0;
              bottom: 0;
              top: 0;
              border-radius: 0;
              position: fixed;
              z-index: 99999;
          }
          
          /* Ajuste para barra do navegador */
          @supports (padding: max(0px)) {
              #gg-help-chat {
                  height: calc(100vh - max(env(safe-area-inset-bottom), 60px));
              }
          }
      }

      @keyframes slideUp {
          from { opacity: 0; transform: translateY(30px); }
          to { opacity: 1; transform: translateY(0); }
      }

      @keyframes slideDown {
          from { opacity: 1; transform: translateY(0); }
          to { opacity: 0; transform: translateY(30px); }
      }

      .gg-help-hide {
          animation: slideDown 0.3s ease-in forwards;
      }

      #gg-help-header {
          background: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
          color: white;
          padding: 20px;
          font-weight: 600;
          font-size: 18px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          border-top-left-radius: 18px;
          border-top-right-radius: 18px;
          border-bottom: 2px solid rgba(147, 51, 234, 0.3);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      @media (max-width: 768px) {
          #gg-help-header {
              padding: 15px 18px;
              font-size: 16px;
          }
          
          #gg-help-header .gg-header-content img {
              width: 32px;
              height: 32px;
          }
          
          .gg-header-title strong {
              font-size: 16px;
          }
          
          .gg-header-status {
              font-size: 13px;
          }
      }

      @media (max-width: 480px) {
          #gg-help-header {
              padding: 15px 20px;
              font-size: 16px;
              border-radius: 0;
          }
          
          #gg-help-header .gg-header-content img {
              width: 32px;
              height: 32px;
          }
          
          .gg-header-title strong {
              font-size: 16px;
          }
          
          .gg-header-status {
              font-size: 13px;
          }
      }

      #gg-help-header .gg-header-content {
          display: flex;
          align-items: center;
          gap: 12px;
      }

      #gg-help-header .gg-header-content img {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          border: 2px solid rgba(147, 51, 234, 0.5);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .gg-header-title {
          display: flex;
          flex-direction: column;
          line-height: 1.3;
      }

      .gg-header-title strong {
          font-size: 17px;
          font-weight: 600;
          color: #ffffff;
      }

      .gg-header-status {
          display: flex;
          align-items: center;
          gap: 6px;
          font-size: 13px;
          color: #d1d5db;
          font-weight: 400;
      }

      .online-indicator {
          width: 10px;
          height: 10px;
          background-color: #2ecc71;
          border-radius: 50%;
          border: 2px solid #000000;
          box-shadow: 0 0 0 2px rgba(46, 204, 113, 0.3);
          animation: pulse-green 2s infinite;
      }

      @keyframes pulse-green {
          0% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7); }
          70% { box-shadow: 0 0 0 4px rgba(46, 204, 113, 0); }
          100% { box-shadow: 0 0 0 0 rgba(46, 204, 113, 0); }
      }

      #gg-help-body {
          flex: 1;
          background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
          padding: 20px 15px;
          display: flex;
          flex-direction: column;
          overflow-y: auto;
          gap: 12px;
          position: relative;
      }

      #gg-help-body::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 1px;
          background: linear-gradient(90deg, transparent, rgba(147, 51, 234, 0.2), transparent);
      }

      @media (max-width: 768px) {
          #gg-help-body {
              padding: 15px 12px;
              gap: 6px;
          }
      }

      @media (max-width: 480px) {
          #gg-help-body {
              padding: 20px 15px;
              gap: 8px;
              padding-bottom: 80px;
              overflow-y: auto;
              -webkit-overflow-scrolling: touch;
          }
      }

      .gg-help-msg-bot {
          background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
          color: white;
          align-self: flex-start;
          padding: 16px 20px;
          border-radius: 20px 20px 20px 8px;
          margin-bottom: 12px;
          max-width: 80%;
          font-size: 15px;
          line-height: 1.5;
          box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
          position: relative;
      }

      .gg-help-msg-bot::before {
          content: '';
          position: absolute;
          left: -8px;
          bottom: 0;
          width: 0;
          height: 0;
          border-style: solid;
          border-width: 0 8px 8px 0;
          border-color: transparent #2563eb transparent transparent;
      }

      .gg-help-msg-user {
          background: linear-gradient(135deg, #f1f3f4 0%, #e8eaed 100%);
          color: #1a1a1a;
          align-self: flex-end;
          padding: 16px 20px;
          border-radius: 20px 20px 8px 20px;
          margin-bottom: 12px;
          max-width: 80%;
          font-size: 15px;
          line-height: 1.5;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          position: relative;
      }

      .gg-help-msg-user::before {
          content: '';
          position: absolute;
          right: -8px;
          bottom: 0;
          width: 0;
          height: 0;
          border-style: solid;
          border-width: 0 0 8px 8px;
          border-color: transparent transparent #e8eaed transparent;
      }

      @media (max-width: 768px) {
          .gg-help-msg-bot, .gg-help-msg-user {
              padding: 12px 16px;
              font-size: 14px;
              max-width: 85%;
              margin-bottom: 8px;
              word-wrap: break-word;
              overflow-wrap: break-word;
          }
      }

      @media (max-width: 480px) {
          .gg-help-msg-bot, .gg-help-msg-user {
              padding: 12px 16px;
              font-size: 15px;
              max-width: 85%;
              margin-bottom: 8px;
          }
      }

      .gg-help-msg-bot strong {
          font-weight: 600;
          color: #ffffff;
      }

      .gg-help-msg-bot em {
          font-style: italic;
          color: #e5e7eb;
      }

      .gg-help-msg-bot ul, .gg-help-msg-bot ol {
          padding-left: 25px;
          margin: 12px 0;
      }

      .gg-help-msg-bot a {
          color: #c0d8ff;
          text-decoration: underline;
      }

      .gg-help-typing {
          font-size: 13.5px;
          padding: 10px 16px;
          background: #f0f0f0;
          color: #555555;
          border-radius: 18px;
          max-width: fit-content;
          align-self: flex-start;
          margin-bottom: 8px;
          opacity: 1;
          font-style: normal;
          display: flex;
          align-items: center;
          gap: 4px;
      }

      .dot-loader span {
          animation: blinkDots 1.4s infinite;
          display: inline-block;
          width: 6px;
          height: 6px;
          background-color: #555555;
          border-radius: 50%;
          margin: 0 1px;
      }

      .dot-loader span:nth-child(2) { animation-delay: 0.2s; }
      .dot-loader span:nth-child(3) { animation-delay: 0.4s; }

      @keyframes blinkDots {
          0%, 100% { opacity: 0.2; }
          50% { opacity: 1; }
      }

      #gg-help-footer {
          padding: 18px 20px;
          background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
          display: flex;
          gap: 14px;
          border-top: 2px solid rgba(147, 51, 234, 0.1);
          border-bottom-left-radius: 18px;
          border-bottom-right-radius: 18px;
          align-items: center;
          box-sizing: border-box;
          box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
      }

      @media (max-width: 768px) {
          #gg-help-footer {
              padding: 10px 12px;
              gap: 4px;
              flex-direction: row;
              align-items: center;
          }
          
          #gg-help-input {
              padding: 8px 10px;
              font-size: 12px;
              min-width: 0;
              flex: 1;
              max-width: calc(100% - 50px);
          }
          
          #gg-help-send {
              padding: 0;
              font-size: 14px;
              white-space: nowrap;
              flex-shrink: 0;
              min-width: 40px;
              width: 40px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
          }
      }

      @media (max-width: 480px) {
          #gg-help-footer {
              padding: 12px 15px 20px 15px;
              gap: 8px;
              border-radius: 0;
              padding-bottom: calc(12px + env(safe-area-inset-bottom, 0px) + 20px);
          }
          
          #gg-help-input {
              padding: 10px 12px;
              font-size: 14px;
              max-width: calc(100% - 50px);
          }
          
          #gg-help-send {
              padding: 0;
              font-size: 16px;
              min-width: 40px;
              width: 40px;
              height: 36px;
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
          }
      }

      #gg-help-input {
          flex: 1;
          padding: 14px 18px;
          border: 2px solid #e1e5e9;
          border-radius: 25px;
          background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
          color: #333333;
          outline: none;
          transition: all 0.3s ease;
          font-size: 15px;
          min-width: 0;
          box-sizing: border-box;
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      #gg-help-input:focus {
          border-color: rgba(147, 51, 234, 0.5);
          box-shadow: 0 4px 12px rgba(147, 51, 234, 0.15);
          transform: translateY(-1px);
      }

      #gg-help-input::placeholder {
          color: #6c757d;
          font-style: italic;
      }

      #gg-help-send {
          background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 25px;
          cursor: pointer;
          font-weight: 600;
          font-size: 15px;
          transition: all 0.3s ease;
          white-space: nowrap;
          flex-shrink: 0;
          box-sizing: border-box;
          box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
          position: relative;
          overflow: hidden;
      }

      #gg-help-send::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
          transition: left 0.5s;
      }

      #gg-help-send:hover {
          background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
          transform: translateY(-2px);
          box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
      }

      #gg-help-send:hover::before {
          left: 100%;
      }

      #gg-help-send:active {
          transform: translateY(0);
      }

      .gg-help-close {
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.2);
          color: white;
          font-size: 18px;
          cursor: pointer;
          width: 32px;
          height: 32px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
      }

      .gg-help-close:hover {
          background: rgba(255, 255, 255, 0.2);
          transform: scale(1.1);
      }
    </style>
    
    <!-- Removido script do Chatvolt que estava causando problemas com o ícone -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@chatvolt/embeds@latest/dist/chatbox/index.umd.js"></script> -->
  </head>

  <body>
    <div id="root"></div>
    <div id="gg-help-widget-root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Verificar se o tema dark está sendo aplicado
      const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            console.log('Classe do body mudou:', document.body.className);
          }
        });
      });
      
      observer.observe(document.body, {
        attributes: true,
        attributeFilter: ['class']
      });
      
      // Verificar se o tema dark está sendo aplicado ao html
      const htmlObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
          if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
            console.log('Classe do html mudou:', document.documentElement.className);
          }
        });
      });
      
      htmlObserver.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });
    </script>
    <!-- Removido script de inicialização do Chatvolt -->
    <!-- <script>
      window.addEventListener('DOMContentLoaded', () => {
        ChatvoltChatbox.initBubble({
          agentId: 'cmb81qy5f0bswhy5npr0p9sxh',
          contact: {
            firstName: 'John',
            lastName: 'Doe',
            email: 'customer@email.com',
            phoneNumber: '+33612345644',
          },
          interface: {
            initialMessages: [
              'Hello Marcos how are you doing today?',
              'How can I help you ?',
            ],
          },
          context: 
            'The user lives in the city of São Paulo and is interested in learning more details about the online consulting service.',
        })
      })
    </script> -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('/sw.js')
            .then((registration) => {
              console.log('SW registrado com sucesso:', registration)
            })
            .catch((error) => {
              console.log('Falha ao registrar SW:', error)
            })
        })
      }
    </script>
    
    <!-- Chat Widget Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const root = document.getElementById("gg-help-widget-root");
        if (!root) return;

        // Função para verificar se deve mostrar o chat
        const shouldShowChat = () => {
          const currentPath = window.location.pathname;
          return currentPath === '/' || currentPath === '/index.html' || currentPath === '';
        };

        // Verificar se está na página inicial (não no catálogo)
        if (!shouldShowChat()) {
          return; // Não mostrar o chat em outras páginas
        }

        const widgetHTML = `
          <button id="gg-help-button">
            <img src="https://orcamento-rapido-catalogo-xp.vercel.app/icon-192x192.png" alt="XP Assistant Icon" style="width: 100%; height: 100%; object-fit: contain;">
          </button>
          <div id="gg-help-chat">
            <div id="gg-help-header">
              <div class="gg-header-content">
                <img src="https://orcamento-rapido-catalogo-xp.vercel.app/icon-192x192.png" alt="XP Icon">
                <div class="gg-header-title">
                  <strong>Assistente XP</strong>
                  <div class="gg-header-status">
                    <span class="online-indicator"></span>
                    <span>Online</span>
                  </div>
                </div>
              </div>
              <button id="gg-help-close-btn" class="gg-help-close" aria-label="Minimize Chat">—</button>
            </div>
            <div id="gg-help-body">
              <div class="gg-help-msg-bot"><strong>Oi! 👋 Como posso te ajudar?</strong></div>
            </div>
                         <div id="gg-help-footer">
               <input type="text" id="gg-help-input" placeholder="Digite sua mensagem..." />
               <button id="gg-help-send">→</button>
             </div>
          </div>
        `;

        root.innerHTML = widgetHTML;

        // Seleciona os elementos após serem criados
        const chatBox = document.getElementById("gg-help-chat");
        const toggleButton = document.getElementById("gg-help-button");
        const closeButton = document.getElementById("gg-help-close-btn");
        const sendButton = document.getElementById("gg-help-send");
        const inputField = document.getElementById("gg-help-input");
        const chatBody = document.getElementById("gg-help-body");

        // Funções do chat
        const toggleChat = () => {
            chatBox.style.display = "flex";
            toggleButton.style.display = "none";
            toggleButton.classList.remove("blink");
        };

        const minimizeChat = () => {
            chatBox.classList.add("gg-help-hide");
            setTimeout(() => {
                chatBox.style.display = "none";
                chatBox.classList.remove("gg-help-hide");
                toggleButton.style.display = "flex";
            }, 300);
        };

        const scrollToBottom = () => {
            chatBody.scrollTop = chatBody.scrollHeight;
        };

        const sendMessage = () => {
            const message = inputField.value.trim();
            if (!message) return;

            const userMsg = document.createElement("div");
            userMsg.className = "gg-help-msg-user";
            userMsg.textContent = message;
            chatBody.appendChild(userMsg);
            scrollToBottom();
            inputField.value = "";

            const typingIndicator = document.createElement("div");
            typingIndicator.className = "gg-help-typing dot-loader";
            typingIndicator.innerHTML = `Digitando<span></span><span></span><span></span>`;
            chatBody.appendChild(typingIndicator);
            scrollToBottom();

            const chatId = sessionStorage.getItem("chatId") || "chat_" + Math.random().toString(36).substr(2, 9);
            sessionStorage.setItem("chatId", chatId);

            fetch('https://exportelas-n8n-webhook.f0dgeg.easypanel.host/webhook/6b663fec-fb1c-40cb-b07b-2d55caef24bd/chat', {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    chatId: chatId,
                    message: message,
                    route: "general"
                })
            })
            .then(res => res.json())
            .then(data => {
                setTimeout(() => {
                    typingIndicator.remove();
                    const botMsg = document.createElement("div");
                    botMsg.className = "gg-help-msg-bot";
                    if (typeof marked !== 'undefined') {
                        botMsg.innerHTML = marked.parse(data.output || "Desculpe, não entendi.");
                    } else {
                        botMsg.textContent = data.output || "Desculpe, não entendi.";
                    }
                    chatBody.appendChild(botMsg);
                    scrollToBottom();
                    if (chatBox.style.display === "none") {
                        toggleButton.classList.add("blink");
                    }
                }, 1000);
            })
            .catch(err => {
                typingIndicator.remove();
                console.error("Erro:", err);
                const errorMsg = document.createElement("div");
                errorMsg.className = "gg-help-msg-bot";
                errorMsg.textContent = "Ocorreu um erro. Tente novamente mais tarde.";
                chatBody.appendChild(errorMsg);
                scrollToBottom();
            });
        };

        // Adiciona os listeners para os eventos
        toggleButton.addEventListener("click", toggleChat);
        closeButton.addEventListener("click", minimizeChat);
        sendButton.addEventListener("click", sendMessage);
        inputField.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                sendMessage();
            }
        });

        // Listener para mudanças de rota (SPAs)
        const originalPushState = history.pushState;
        const originalReplaceState = history.replaceState;
        
        history.pushState = function(...args) {
          originalPushState.apply(history, args);
          handleRouteChange();
        };
        
        history.replaceState = function(...args) {
          originalReplaceState.apply(history, args);
          handleRouteChange();
        };
        
        window.addEventListener('popstate', handleRouteChange);
        
        function handleRouteChange() {
          if (!shouldShowChat()) {
            // Esconder o chat se não estiver na página inicial
            const chatBox = document.getElementById("gg-help-chat");
            const toggleButton = document.getElementById("gg-help-button");
            if (chatBox && toggleButton) {
              chatBox.style.display = "none";
              toggleButton.style.display = "none";
            }
          } else {
            // Mostrar o botão se estiver na página inicial
            const toggleButton = document.getElementById("gg-help-button");
            if (toggleButton) {
              toggleButton.style.display = "flex";
            }
          }
        }
      });
    </script>
  </body>
</html>
